# 採点とレギュレーション
## 採点方法について
チューニング結果をVMに反映し、[評価スクリプト](./99_manual.mdd#%E8%A9%95%E4%BE%A1)を実行することで採点ができます。

評価スクリプトでは、以下のプロセスで採点します。
- Step1. データベース、および添付ファイルを初期状態に戻す
- Step2. [簡易DBマイグレーションの実行](./99_manual.md#%E7%B0%A1%E6%98%93db%E3%83%9E%E3%82%A4%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E6%A9%9F%E8%83%BD)
- Step3. API動作テストの実施
- Step4. 負荷試験の実施
- Step5. スコアの計算
- Step6. スコアの表示

Step3では[API仕様書](./98_api.md)をベースに、主要な要件を満たしているかをチェックします。問題があった場合はスコアの減点、あるいは0点になります。

Step4では各APIに対して多数のリクエストを行い、処理できたリクエスト数に基づきスコアが計算されます。

Step6で表示されたスコアが、その時点のチームの持ち点になります。

スコア上位グループについては、成果物に対して追加で審議される場合があります。

## レギュレーション
原則は、「業務アプリケーションの改善」という観点でチューニングすることです。

以下のケースでは減点、0点、失格の対象となります。
- 原則を大きく逸脱した、極端な最適化を行うこと
  - API動作テストはPASSするが、業務アプリとして実質使えなくなるような最適化はNGです。
  - 微妙なラインの場合は、審議します。
- 初期状態のデータを欠損させるような最適化
  - データを消して高速化するなど
  - ただし画像については、UI上十分機能する場合に限り、変換や圧縮を認めます
- UIが明らかに変わるような仕様変更
- 採点中に提供された環境以外のリソースを利用し、処理能力を上げること(例: 個人PCでリクエスト処理を代替する)
- 採点モジュールの改ざん、または不具合を悪用し不当にスコアを上げること
- 他チームの環境にログイン、コードを変更、DOS攻撃等の妨害行為
- 他チームと結託すること
- その他、主催者側が不適切と判断した行為

「これはOK?」と思った時は、[マニュアル](./99_manual.md)を参照してください。

## 評価スクリプトの動作詳細
### Step5の補足
Step5では、さらに以下のステップでスコアが求められます。
- Step5-1. Step4.の結果から、各APIの成功応答回数を求める
- Step5-2. 5-1.の結果から、成功回数が最も多いAPIの成功応答回数(X)、および最も少ない成功応答回数(Y)を求める
- Step5-3. それぞれのAPIの成功回数と、そのAPIに設定された補正係数をかけた値の合計Zを計算し、ceil(Z)をベーススコアとする
  - ```GET /categories```については、```POST /records```の成功応答回数+1の4倍を上限に、成功応答回数が考慮される。それ以上は加点しない。
- Step5-4. floor(X/(Y+1))が50を上回る場合、リクエスト失敗が多いとみなされ、減点される 
  - floor(X/(Y+1)) - 50 回数分、以下の減点がされる
  - ベーススコアから、floor(ベーススコア* 0.01)減点。
- Step5-5. この時点のベーススコアを最終的なスコアとする

補正係数:

|API名|値|
|--|--|
|GET /categories|0.7|
|POST /files|1.4|
|GET /record-views/allActive|1.2|
|GET /record-views/allClosed|1.3|
|GET /record-views/mineActive|1.2|
|GET /record-views/tomeActive|1.4|
|POST /records|1.2|
|GET /records/[recordId]|1|
|PUT /records/[recordId]|0.8|
|GET /records/[recordId]/comments|0.9|
|POST /records/[recordId]/comments|1|
|GET /records/[recordId]/files/[itemId]|1|
|GET /records/[recordId]/files/[itemId]/thumbnail|1|

[次へ](./10_end.md)
